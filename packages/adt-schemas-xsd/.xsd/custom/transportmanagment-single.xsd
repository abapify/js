<?xml version="1.0" encoding="utf-8"?>
<!--
  Standalone schema for single transport GET response.
  
  GET /sap/bc/adt/cts/transportrequests/{trkorr}
  
  This is a DIFFERENT structure from the list response (transportmanagment.xsd).
  The list response has: root > workbench/customizing > modifiable > request
  The single response has: root > request (direct child)
  
  This schema is standalone - no include/redefine needed.
-->
<xs:schema 
  xmlns:xs="http://www.w3.org/2001/XMLSchema"
  xmlns:tm="http://www.sap.com/cts/adt/tm"
  xmlns:atom="http://www.w3.org/2005/Atom"
  targetNamespace="http://www.sap.com/cts/adt/tm"
  elementFormDefault="qualified"
  attributeFormDefault="qualified">
  
  <xs:import namespace="http://www.w3.org/2005/Atom" schemaLocation="../sap/atom.xsd"/>

  <!-- ========================================================================
       ROOT - single transport response root element
       ======================================================================== -->
  
  <xs:element name="root" type="tm:Root"/>
  
  <xs:complexType name="Root">
    <xs:sequence>
      <xs:element ref="atom:link" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="request" type="tm:Request" minOccurs="0" maxOccurs="1"/>
    </xs:sequence>
    <xs:attribute name="object_type" type="xs:string"/>
    <!-- adtcore attributes - defined locally since adtcore doesn't export global attrs -->
    <xs:attribute name="name" type="xs:string"/>
    <xs:attribute name="type" type="xs:string"/>
    <xs:attribute name="changedAt" type="xs:string"/>
    <xs:attribute name="changedBy" type="xs:string"/>
    <xs:attribute name="createdBy" type="xs:string"/>
  </xs:complexType>
  
  <!-- ========================================================================
       REQUEST - transport request with full details
       ======================================================================== -->
  
  <xs:complexType name="Request">
    <xs:sequence>
      <xs:element name="long_desc" type="xs:string" minOccurs="0"/>
      <xs:element ref="atom:link" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="attributes" type="tm:Attributes" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="task" type="tm:Task" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="all_objects" type="tm:AllObjects" minOccurs="0"/>
      <xs:element name="review" type="tm:Review" minOccurs="0"/>
      <xs:element name="dynamic_attributes" type="tm:DynamicAttributes" minOccurs="0"/>
    </xs:sequence>
    <xs:attribute name="number" type="xs:string"/>
    <xs:attribute name="owner" type="xs:string"/>
    <xs:attribute name="desc" type="xs:string"/>
    <xs:attribute name="status" type="xs:string"/>
    <xs:attribute name="uri" type="xs:string"/>
    <xs:attribute name="type" type="xs:string"/>
    <xs:attribute name="status_text" type="xs:string"/>
    <xs:attribute name="target" type="xs:string"/>
    <xs:attribute name="target_desc" type="xs:string"/>
    <xs:attribute name="source_client" type="xs:string"/>
    <xs:attribute name="parent" type="xs:string"/>
    <xs:attribute name="cts_project" type="xs:string"/>
    <xs:attribute name="cts_project_desc" type="xs:string"/>
    <xs:attribute name="lastchanged_timestamp" type="xs:string"/>
    <xs:attribute name="docu" type="xs:string"/>
  </xs:complexType>
  
  <!-- ========================================================================
       TASK - transport task with objects
       ======================================================================== -->
  
  <xs:complexType name="Task">
    <xs:sequence>
      <xs:element name="long_desc" type="xs:string" minOccurs="0"/>
      <xs:element ref="atom:link" minOccurs="0" maxOccurs="unbounded"/>
      <xs:element name="abap_object" type="tm:AbapObject" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attribute name="number" type="xs:string"/>
    <xs:attribute name="owner" type="xs:string"/>
    <xs:attribute name="desc" type="xs:string"/>
    <xs:attribute name="status" type="xs:string"/>
    <xs:attribute name="uri" type="xs:string"/>
    <xs:attribute name="type" type="xs:string"/>
    <xs:attribute name="status_text" type="xs:string"/>
    <xs:attribute name="target" type="xs:string"/>
    <xs:attribute name="target_desc" type="xs:string"/>
    <xs:attribute name="source_client" type="xs:string"/>
    <xs:attribute name="parent" type="xs:string"/>
    <xs:attribute name="cts_project" type="xs:string"/>
    <xs:attribute name="cts_project_desc" type="xs:string"/>
    <xs:attribute name="lastchanged_timestamp" type="xs:string"/>
    <xs:attribute name="docu" type="xs:string"/>
  </xs:complexType>
  
  <!-- ========================================================================
       ABAP_OBJECT - transport object entry
       ======================================================================== -->
  
  <xs:complexType name="AbapObject">
    <xs:sequence>
      <xs:element ref="atom:link" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
    <xs:attribute name="pgmid" type="xs:string"/>
    <xs:attribute name="type" type="xs:string"/>
    <xs:attribute name="name" type="xs:string"/>
    <xs:attribute name="wbtype" type="xs:string"/>
    <xs:attribute name="uri" type="xs:string"/>
    <xs:attribute name="dummy_uri" type="xs:string"/>
    <xs:attribute name="obj_info" type="xs:string"/>
    <xs:attribute name="obj_desc" type="xs:string"/>
    <xs:attribute name="lock_status" type="xs:string"/>
    <xs:attribute name="position" type="xs:string"/>
    <xs:attribute name="img_activity" type="xs:string"/>
    <xs:attribute name="obj_func" type="xs:string"/>
  </xs:complexType>
  
  <!-- ========================================================================
       ALL_OBJECTS - container for all objects across tasks
       ======================================================================== -->
  
  <xs:complexType name="AllObjects">
    <xs:sequence>
      <xs:element name="abap_object" type="tm:AbapObject" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  
  <!-- ========================================================================
       ATTRIBUTES - transport attributes (SAPNOTE, etc.)
       ======================================================================== -->
  
  <xs:complexType name="Attributes">
    <xs:attribute name="attribute" type="xs:string"/>
    <xs:attribute name="description" type="xs:string"/>
    <xs:attribute name="value" type="xs:string"/>
    <xs:attribute name="position" type="xs:string"/>
  </xs:complexType>
  
  <!-- ========================================================================
       REVIEW - code review integration
       ======================================================================== -->
  
  <xs:complexType name="Review">
    <xs:attribute name="repository_id" type="xs:string"/>
    <xs:attribute name="repository_url" type="xs:string"/>
    <xs:attribute name="repository_branch" type="xs:string"/>
    <xs:attribute name="pull_request_url" type="xs:string"/>
  </xs:complexType>
  
  <!-- ========================================================================
       DYNAMIC_ATTRIBUTES - dynamic attribute container
       ======================================================================== -->
  
  <xs:complexType name="DynamicAttributes">
    <xs:sequence>
      <xs:element name="dynamic_attribute" type="tm:DynamicAttribute" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  
  <xs:complexType name="DynamicAttribute">
    <xs:sequence>
      <xs:element name="properties" type="tm:AttributeProperties" minOccurs="0"/>
    </xs:sequence>
    <xs:attribute name="attribute" type="xs:string"/>
    <xs:attribute name="value" type="xs:string"/>
    <xs:attribute name="description" type="xs:string"/>
    <xs:attribute name="domain_name" type="xs:string"/>
  </xs:complexType>
  
  <xs:complexType name="AttributeProperties">
    <xs:sequence>
      <xs:element name="property" type="tm:AttributeProperty" minOccurs="0" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  
  <xs:complexType name="AttributeProperty">
    <xs:attribute name="key" type="xs:string"/>
    <xs:attribute name="value" type="xs:string"/>
  </xs:complexType>
  
</xs:schema>
